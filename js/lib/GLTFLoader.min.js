THREE.GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}function a(){var e={};return{get:function(a){return e[a]},add:function(a,r){e[a]=r},remove:function(a){delete e[a]},removeAll:function(){e={}},update:function(a,r){for(var t in e){var n=e[t];n.update&&n.update(a,r)}}}}function r(e){this.name=E.KHR_LIGHTS,this.lights={};var a=e.extensions&&e.extensions[E.KHR_LIGHTS]||{},r=a.lights||{};for(var t in r){var n,s=r[t],i=(new THREE.Color).fromArray(s.color);switch(s.type){case"directional":n=new THREE.DirectionalLight(i),n.position.set(0,0,1);break;case"point":n=new THREE.PointLight(i);break;case"spot":n=new THREE.SpotLight(i),n.position.set(0,0,1);break;case"ambient":n=new THREE.AmbientLight(i)}n&&(void 0!==s.constantAttenuation&&(n.intensity=s.constantAttenuation),void 0!==s.linearAttenuation&&(n.distance=1/s.linearAttenuation),void 0!==s.quadraticAttenuation&&(n.decay=s.quadraticAttenuation),void 0!==s.fallOffAngle&&(n.angle=s.fallOffAngle),void 0!==s.fallOffExponent&&console.warn("THREE.GLTFLoader:: light.fallOffExponent not currently supported."),n.name=s.name||"light_"+t,this.lights[t]=n)}}function t(e){this.name=E.KHR_MATERIALS_COMMON}function n(e){this.name=E.KHR_BINARY_GLTF,this.content=null,this.body=null;var a=new DataView(e,0,f);if(this.header={magic:l(new Uint8Array(e.slice(0,4))),version:a.getUint32(4,!0),length:a.getUint32(8,!0)},this.header.magic!==d)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use GLTFLoader instead.");for(var r=new DataView(e,f),t=0;t<r.byteLength;){var n=r.getUint32(t,!0);t+=4;var s=r.getUint32(t,!0);if(t+=4,s===m.JSON){var i=new Uint8Array(e,f+t,n);this.content=l(i)}else if(s===m.BIN){var o=f+t;this.body=e.slice(o,o+n)}t+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function s(){return{name:E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,a,r){var t=a.extensions[this.name],n=THREE.ShaderLib.standard,s=THREE.UniformsUtils.clone(n.uniforms),i=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),o=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),u=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),c=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),p=n.fragmentShader.replace("#include <specularmap_fragment>","").replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",o).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",u).replace("#include <lights_physical_fragment>",c);delete s.roughness,delete s.metalness,delete s.roughnessMap,delete s.metalnessMap,s.specular={value:(new THREE.Color).setHex(1118481)},s.glossiness={value:.5},s.specularMap={value:null},s.glossinessMap={value:null},e.vertexShader=n.vertexShader,e.fragmentShader=p,e.uniforms=s,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var E=[];if(Array.isArray(t.diffuseFactor)){var d=t.diffuseFactor;e.color.fromArray(d),e.opacity=d[3]}if(void 0!==t.diffuseTexture&&E.push(r.assignTexture(e,"map",t.diffuseTexture.index)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==t.glossinessFactor?t.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(t.specularFactor)&&e.specular.fromArray(t.specularFactor),void 0!==t.specularGlossinessTexture){var f=t.specularGlossinessTexture.index;E.push(r.assignTexture(e,"glossinessMap",f)),E.push(r.assignTexture(e,"specularMap",f))}return Promise.all(E)},createMaterial:function(e){var a=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return a.isGLTFSpecularGlossinessMaterial=!0,a.color=e.color,a.map=void 0===e.map?null:e.map,a.lightMap=null,a.lightMapIntensity=1,a.aoMap=void 0===e.aoMap?null:e.aoMap,a.aoMapIntensity=1,a.emissive=e.emissive,a.emissiveIntensity=1,a.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,a.bumpMap=void 0===e.bumpMap?null:e.bumpMap,a.bumpScale=1,a.normalMap=void 0===e.normalMap?null:e.normalMap,a.normalScale=new THREE.Vector2(1,1),a.displacementMap=null,a.displacementScale=1,a.displacementBias=0,a.specularMap=void 0===e.specularMap?null:e.specularMap,a.specular=e.specular,a.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,a.glossiness=e.glossiness,a.alphaMap=null,a.envMap=void 0===e.envMap?null:e.envMap,a.envMapIntensity=1,a.refractionRatio=.98,a.extensions.derivatives=!0,a},refreshUniforms:function(e,a,r,t,n,s){var i=n.uniforms,o=n.defines;i.opacity.value=n.opacity,i.diffuse.value.copy(n.color),i.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),i.map.value=n.map,i.specularMap.value=n.specularMap,i.alphaMap.value=n.alphaMap,i.lightMap.value=n.lightMap,i.lightMapIntensity.value=n.lightMapIntensity,i.aoMap.value=n.aoMap,i.aoMapIntensity.value=n.aoMapIntensity;var l;if(n.map?l=n.map:n.specularMap?l=n.specularMap:n.displacementMap?l=n.displacementMap:n.normalMap?l=n.normalMap:n.bumpMap?l=n.bumpMap:n.glossinessMap?l=n.glossinessMap:n.alphaMap?l=n.alphaMap:n.emissiveMap&&(l=n.emissiveMap),void 0!==l){l.isWebGLRenderTarget&&(l=l.texture);var u=l.offset,c=l.repeat;i.offsetRepeat.value.set(u.x,u.y,c.x,c.y)}i.envMap.value=n.envMap,i.envMapIntensity.value=n.envMapIntensity,i.flipEnvMap.value=n.envMap&&n.envMap.isCubeTexture?-1:1,i.refractionRatio.value=n.refractionRatio,i.specular.value.copy(n.specular),i.glossiness.value=n.glossiness,i.glossinessMap.value=n.glossinessMap,i.emissiveMap.value=n.emissiveMap,i.bumpMap.value=n.bumpMap,i.normalMap.value=n.normalMap,i.displacementMap.value=n.displacementMap,i.displacementScale.value=n.displacementScale,i.displacementBias.value=n.displacementBias,null!==i.glossinessMap.value&&void 0===o.USE_GLOSSINESSMAP&&(o.USE_GLOSSINESSMAP="",o.USE_ROUGHNESSMAP=""),null===i.glossinessMap.value&&void 0!==o.USE_GLOSSINESSMAP&&(delete o.USE_GLOSSINESSMAP,delete o.USE_ROUGHNESSMAP)}}}function i(e,a,r){if(!e)return Promise.resolve();var t,n=[];if("[object Array]"===Object.prototype.toString.call(e)){t=[];for(var s=e.length,i=0;i<s;i++){var o=a.call(r||this,e[i],i);o&&(n.push(o),o instanceof Promise?o.then(function(e,a){t[e]=a}.bind(this,i)):t[i]=o)}}else{t={};for(var l in e)if(e.hasOwnProperty(l)){var o=a.call(r||this,e[l],l);o&&(n.push(o),o instanceof Promise?o.then(function(e,a){t[e]=a}.bind(this,l)):t[l]=o)}}return Promise.all(n).then(function(){return t})}function o(e,a){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:(a||"")+e}function l(e){if(void 0!==window.TextDecoder)return(new TextDecoder).decode(e);for(var a="",r=0,t=e.length;r<t;r++)a+=String.fromCharCode(e[r]);return a}function u(){return new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})}function c(e,a,r,t){var n=e.geometry,s=e.material,i=r.targets,o=n.morphAttributes;o.position=[],o.normal=[],s.morphTargets=!0;for(var l=0,u=i.length;l<u;l++){var c,p,E=i[l],d="morphTarget"+l;if(void 0!==E.POSITION){c=t.accessors[E.POSITION].clone();for(var f=n.attributes.position,m=0,h=c.count;m<h;m++)c.setXYZ(m,c.getX(m)+f.getX(m),c.getY(m)+f.getY(m),c.getZ(m)+f.getZ(m))}else c=n.attributes.position.clone();if(void 0!==E.NORMAL){s.morphNormals=!0,p=t.accessors[E.NORMAL].clone();for(var T=n.attributes.normal,m=0,h=p.count;m<h;m++)p.setXYZ(m,p.getX(m)+T.getX(m),p.getY(m)+T.getY(m),p.getZ(m)+T.getZ(m))}else p=n.attributes.normal.clone();void 0!==E.TANGENT,c.name=d,p.name=d,o.position.push(c),o.normal.push(p)}if(e.updateMorphTargets(),void 0!==a.weights)for(var l=0,u=a.weights.length;l<u;l++)e.morphTargetInfluences[l]=a.weights[l]}function p(e,r,t){this.json=e||{},this.extensions=r||{},this.options=t||{},this.cache=new a}e.prototype={constructor:e,crossOrigin:"Anonymous",load:function(e,a,r,t){var n=this,s=this.path&&"string"==typeof this.path?this.path:THREE.Loader.prototype.extractUrlBase(e),i=new THREE.FileLoader(n.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){try{n.parse(e,s,a,t)}catch(e){t(e.constructor===Error?e:new Error("THREE.GLTFLoader: Unable to parse model."))}},r,t)},setCrossOrigin:function(e){this.crossOrigin=e},setPath:function(e){this.path=e},parse:function(e,a,i,o){var u,c={},f=l(new Uint8Array(e,0,4));f===d?(c[E.KHR_BINARY_GLTF]=new n(e),u=c[E.KHR_BINARY_GLTF].content):u=l(new Uint8Array(e));var m=JSON.parse(u);if(void 0===m.asset||m.asset.version[0]<2)return void o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));m.extensionsUsed&&(m.extensionsUsed.indexOf(E.KHR_LIGHTS)>=0&&(c[E.KHR_LIGHTS]=new r(m)),m.extensionsUsed.indexOf(E.KHR_MATERIALS_COMMON)>=0&&(c[E.KHR_MATERIALS_COMMON]=new t(m)),m.extensionsUsed.indexOf(E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS)>=0&&(c[E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]=new s)),console.time("GLTFLoader");var h=new p(m,c,{path:a||this.path,crossOrigin:this.crossOrigin});h.parse(function(e,a,r,t){console.timeEnd("GLTFLoader");var n={scene:e,scenes:a,cameras:r,animations:t};i(n)},o)}};var E={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_LIGHTS:"KHR_lights",KHR_MATERIALS_COMMON:"KHR_materials_common",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness"};t.prototype.getMaterialType=function(e){var a=e.extensions[this.name];switch(a.type){case"commonBlinn":case"commonPhong":return THREE.MeshPhongMaterial;case"commonLambert":return THREE.MeshLambertMaterial;case"commonConstant":default:return THREE.MeshBasicMaterial}},t.prototype.extendParams=function(e,a,r){var t=a.extensions[this.name],n=[],s=[];switch(t.type){case"commonBlinn":case"commonPhong":s.push("diffuseFactor","diffuseTexture","specularFactor","specularTexture","shininessFactor");break;case"commonLambert":s.push("diffuseFactor","diffuseTexture");break;case"commonConstant":}var i={};return s.forEach(function(e){void 0!==t[e]&&(i[e]=t[e])}),void 0!==i.diffuseFactor&&(e.color=(new THREE.Color).fromArray(i.diffuseFactor),e.opacity=i.diffuseFactor[3]),void 0!==i.diffuseTexture&&n.push(r.assignTexture(e,"map",i.diffuseTexture.index)),void 0!==i.specularFactor&&(e.specular=(new THREE.Color).fromArray(i.specularFactor)),void 0!==i.specularTexture&&n.push(r.assignTexture(e,"specularMap",i.specularTexture.index)),void 0!==i.shininessFactor&&(e.shininess=i.shininessFactor),Promise.all(n)};var d="glTF",f=12,m={JSON:1313821514,BIN:5130562},h={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},T=({5126:Number,35675:THREE.Matrix3,35676:THREE.Matrix4,35664:THREE.Vector2,35665:THREE.Vector3,35666:THREE.Vector4,35678:THREE.Texture},{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),v={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},R={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},g={6406:THREE.AlphaFormat,6407:THREE.RGBFormat,6408:THREE.RGBAFormat,6409:THREE.LuminanceFormat,6410:THREE.LuminanceAlphaFormat},M={5121:THREE.UnsignedByteType,32819:THREE.UnsignedShort4444Type,32820:THREE.UnsignedShort5551Type,33635:THREE.UnsignedShort565Type},S=({1028:THREE.BackSide,1029:THREE.FrontSide},{512:THREE.NeverDepth,513:THREE.LessDepth,514:THREE.EqualDepth,515:THREE.LessEqualDepth,516:THREE.GreaterEqualDepth,517:THREE.NotEqualDepth,518:THREE.GreaterEqualDepth,519:THREE.AlwaysDepth},{32774:THREE.AddEquation,32778:THREE.SubtractEquation,32779:THREE.ReverseSubtractEquation},{0:THREE.ZeroFactor,1:THREE.OneFactor,768:THREE.SrcColorFactor,769:THREE.OneMinusSrcColorFactor,770:THREE.SrcAlphaFactor,771:THREE.OneMinusSrcAlphaFactor,772:THREE.DstAlphaFactor,773:THREE.OneMinusDstAlphaFactor,774:THREE.DstColorFactor,775:THREE.OneMinusDstColorFactor,776:THREE.SrcAlphaSaturateFactor},{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),H={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},L={CATMULLROMSPLINE:THREE.InterpolateSmooth,CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},A={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};return p.prototype._withDependencies=function(e){for(var a={},r=0;r<e.length;r++){var t=e[r],n="load"+t.charAt(0).toUpperCase()+t.slice(1),s=this.cache.get(t);if(void 0!==s)a[t]=s;else if(this[n]){var o=this[n]();this.cache.add(t,o),a[t]=o}}return i(a,function(e){return e})},p.prototype.parse=function(e,a){var r=this.json;this.cache.removeAll(),this._withDependencies(["scenes","cameras","animations"]).then(function(a){var t=[];for(var n in a.scenes)t.push(a.scenes[n]);var s=void 0!==r.scene?a.scenes[r.scene]:t[0],i=[];for(var n in a.cameras){var o=a.cameras[n];i.push(o)}var l=[];for(var n in a.animations)l.push(a.animations[n]);e(s,t,i,l)}).catch(a)},p.prototype.getDependency=function(e,a){var r=e+":"+a,t=this.cache.get(r);if(!t){var n="load"+e.charAt(0).toUpperCase()+e.slice(1);t=this[n](a),this.cache.add(r,t)}return t},p.prototype.loadBuffer=function(e){var a=this.json.buffers[e];if(a.type&&"arraybuffer"!==a.type)throw new Error("THREE.GLTFLoader: %s buffer type is not supported.",a.type);if(void 0===a.uri&&0===e)return Promise.resolve(this.extensions[E.KHR_BINARY_GLTF].body);var r=this.options;return new Promise(function(e){var t=new THREE.FileLoader;t.setResponseType("arraybuffer"),t.load(o(a.uri,r.path),e)})},p.prototype.loadBufferView=function(e){var a=this.json.bufferViews[e];return this.getDependency("buffer",a.buffer).then(function(e){var r=a.byteLength||0,t=a.byteOffset||0;return e.slice(t,t+r)})},p.prototype.loadAccessors=function(){var e=this,a=this.json;return i(a.accessors,function(r){return e.getDependency("bufferView",r.bufferView).then(function(e){var t,n=S[r.type],s=T[r.componentType],i=s.BYTES_PER_ELEMENT,o=i*n,l=a.bufferViews[r.bufferView].byteStride;if(l&&l!==o){t=new s(e);var u=new THREE.InterleavedBuffer(t,l/i);return new THREE.InterleavedBufferAttribute(u,n,r.byteOffset/i)}return t=new s(e,r.byteOffset,r.count*n),new THREE.BufferAttribute(t,n)})})},p.prototype.loadTexture=function(e){var a=this,r=this.json,t=this.options,n=window.URL||window.webkitURL,s=r.textures[e],i=r.images[s.source],l=i.uri,u=!1;return void 0!==i.bufferView&&(l=a.getDependency("bufferView",i.bufferView).then(function(e){u=!0;var a=new Blob([e],{type:i.mimeType});return l=n.createObjectURL(a)})),Promise.resolve(l).then(function(e){var a=THREE.Loader.Handlers.get(e)||new THREE.TextureLoader;return a.setCrossOrigin(t.crossOrigin),new Promise(function(r,n){a.load(o(e,t.path),r,void 0,n)})}).then(function(e){void 0!==u&&n.revokeObjectURL(l),e.flipY=!1,void 0!==s.name&&(e.name=s.name),e.format=void 0!==s.format?g[s.format]:THREE.RGBAFormat,void 0!==s.internalFormat&&e.format!==g[s.internalFormat]&&console.warn("THREE.GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),e.type=void 0!==s.type?M[s.type]:THREE.UnsignedByteType;var a=r.samplers||{},t=a[s.sampler]||{};return e.magFilter=v[t.magFilter]||THREE.LinearFilter,e.minFilter=v[t.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=R[t.wrapS]||THREE.RepeatWrapping,e.wrapT=R[t.wrapT]||THREE.RepeatWrapping,e})},p.prototype.assignTexture=function(e,a,r){return this.getDependency("texture",r).then(function(r){e[a]=r})},p.prototype.loadMaterials=function(){var e=this,a=this.json,r=this.extensions;return i(a.materials,function(a){var t,n={},s=a.extensions||{},i=[];if(s[E.KHR_MATERIALS_COMMON]){var o=r[E.KHR_MATERIALS_COMMON];t=o.getMaterialType(a),i.push(o.extendParams(n,a,e))}else if(s[E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=r[E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=l.getMaterialType(a),i.push(l.extendParams(n,a,e))}else if(void 0!==a.pbrMetallicRoughness){t=THREE.MeshStandardMaterial;var u=a.pbrMetallicRoughness;if(n.color=new THREE.Color(1,1,1),n.opacity=1,Array.isArray(u.baseColorFactor)){var c=u.baseColorFactor;n.color.fromArray(c),n.opacity=c[3]}if(void 0!==u.baseColorTexture&&i.push(e.assignTexture(n,"map",u.baseColorTexture.index)),n.metalness=void 0!==u.metallicFactor?u.metallicFactor:1,n.roughness=void 0!==u.roughnessFactor?u.roughnessFactor:1,void 0!==u.metallicRoughnessTexture){var p=u.metallicRoughnessTexture.index;i.push(e.assignTexture(n,"metalnessMap",p)),i.push(e.assignTexture(n,"roughnessMap",p))}}else t=THREE.MeshPhongMaterial;a.doubleSided===!0&&(n.side=THREE.DoubleSide);var d=a.alphaMode||A.OPAQUE;return d!==A.OPAQUE?n.transparent=!0:n.transparent=!1,void 0!==a.normalTexture&&i.push(e.assignTexture(n,"normalMap",a.normalTexture.index)),void 0!==a.occlusionTexture&&i.push(e.assignTexture(n,"aoMap",a.occlusionTexture.index)),void 0!==a.emissiveFactor&&(t===THREE.MeshBasicMaterial?n.color=(new THREE.Color).fromArray(a.emissiveFactor):n.emissive=(new THREE.Color).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&(t===THREE.MeshBasicMaterial?i.push(e.assignTexture(n,"map",a.emissiveTexture.index)):i.push(e.assignTexture(n,"emissiveMap",a.emissiveTexture.index))),Promise.all(i).then(function(){var e;return e=t===THREE.ShaderMaterial?r[E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(n):new t(n),void 0!==a.name&&(e.name=a.name),e.normalScale.x=-1,e.userData=a.extras,e})})},p.prototype.loadGeometries=function(e){return this._withDependencies(["accessors"]).then(function(a){return i(e,function(e){var r=new THREE.BufferGeometry,t=e.attributes;for(var n in t){var s=t[n];if(void 0===s)return;var i=a.accessors[s];switch(n){case"POSITION":r.addAttribute("position",i);break;case"NORMAL":r.addAttribute("normal",i);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":r.addAttribute("uv",i);break;case"TEXCOORD_1":r.addAttribute("uv2",i);break;case"COLOR_0":case"COLOR0":case"COLOR":r.addAttribute("color",i);break;case"WEIGHTS_0":case"WEIGHT":r.addAttribute("skinWeight",i);break;case"JOINTS_0":case"JOINT":r.addAttribute("skinIndex",i)}}return void 0!==e.indices&&r.setIndex(a.accessors[e.indices]),r})})},p.prototype.loadMeshes=function(){var e=this,a=this.json;return this._withDependencies(["accessors","materials"]).then(function(r){return i(a.meshes,function(a){var t=new THREE.Group;void 0!==a.name&&(t.name=a.name),a.extras&&(t.userData=a.extras);var n=a.primitives||[];return e.loadGeometries(n).then(function(e){for(var s in n){var i=n[s],o=e[s],l=void 0===i.material?u():r.materials[i.material];l.aoMap&&void 0===o.attributes.uv2&&void 0!==o.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),o.addAttribute("uv2",new THREE.BufferAttribute(o.attributes.uv.array,2))),void 0!==o.attributes.color&&(l.vertexColors=THREE.VertexColors,l.needsUpdate=!0),void 0===o.attributes.normal&&(void 0!==l.flatShading?l.flatShading=!0:l.shading=THREE.FlatShading);var p;if(i.mode===h.TRIANGLES||void 0===i.mode)p=new THREE.Mesh(o,l);else if(i.mode===h.TRIANGLE_STRIP)p=new THREE.Mesh(o,l),p.drawMode=THREE.TriangleStripDrawMode;else if(i.mode===h.TRIANGLE_FAN)p=new THREE.Mesh(o,l),p.drawMode=THREE.TriangleFanDrawMode;else if(i.mode===h.LINES)p=new THREE.LineSegments(o,l);else if(i.mode===h.LINE_STRIP)p=new THREE.Line(o,l);else if(i.mode===h.LINE_LOOP)p=new THREE.LineLoop(o,l);else{if(i.mode!==h.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: ",i.mode);p=new THREE.Points(o,l)}p.name=t.name+"_"+s,void 0!==i.targets&&c(p,a,i,r),i.extras&&(p.userData=i.extras),t.add(p)}return t})})})},p.prototype.loadCameras=function(){var e=this.json;return i(e.cameras,function(e){var a,r=e[e.type];if(!r)return void console.warn("THREE.GLTFLoader: Missing camera parameters.");if("perspective"===e.type){var t=r.aspectRatio||1,n=r.yfov*t;a=new THREE.PerspectiveCamera(THREE.Math.radToDeg(n),t,r.znear||1,r.zfar||2e6)}else"orthographic"===e.type&&(a=new THREE.OrthographicCamera(r.xmag/-2,r.xmag/2,r.ymag/2,r.ymag/-2,r.znear,r.zfar));return void 0!==e.name&&(a.name=e.name),e.extras&&(a.userData=e.extras),a})},p.prototype.loadSkins=function(){var e=this.json;return this._withDependencies(["accessors"]).then(function(a){return i(e.skins,function(e){var r={joints:e.joints,inverseBindMatrices:a.accessors[e.inverseBindMatrices]};return r})})},p.prototype.loadAnimations=function(){var e=this.json;return this._withDependencies(["accessors","nodes"]).then(function(a){return i(e.animations,function(e,r){var t=[];for(var n in e.channels){var s=e.channels[n],i=e.samplers[s.sampler];if(i){var o=s.target,l=void 0!==o.node?o.node:o.id,u=void 0!==e.parameters?e.parameters[i.input]:i.input,c=void 0!==e.parameters?e.parameters[i.output]:i.output,p=a.accessors[u],E=a.accessors[c],d=a.nodes[l];if(d){d.updateMatrix(),d.matrixAutoUpdate=!0;var f;switch(H[o.path]){case H.weights:f=THREE.NumberKeyframeTrack;break;case H.rotation:f=THREE.QuaternionKeyframeTrack;break;case H.position:case H.scale:default:f=THREE.VectorKeyframeTrack}var m=d.name?d.name:d.uuid;"CATMULLROMSPLINE"===i.interpolation&&console.warn("THREE.GLTFLoader: CATMULLROMSPLINE interpolation is not supported. Using CUBICSPLINE instead.");var h=void 0!==i.interpolation?L[i.interpolation]:THREE.InterpolateLinear,T=[];H[o.path]===H.weights?d.traverse(function(e){e.isMesh===!0&&e.material.morphTargets===!0&&T.push(e.name?e.name:e.uuid)}):T.push(m);for(var v=0,R=T.length;v<R;v++)t.push(new f(T[v]+"."+H[o.path],THREE.AnimationUtils.arraySlice(p.array,0),THREE.AnimationUtils.arraySlice(E.array,0),h))}}}var l=void 0!==e.name?e.name:"animation_"+r;return new THREE.AnimationClip(l,void 0,t)})})},p.prototype.loadNodes=function(){var e=this.json,a=this.extensions,r=this,t=e.nodes||[],n=e.skins||[];return n.forEach(function(e){e.joints.forEach(function(e){t[e].isBone=!0})}),i(e.nodes,function(e){var a=new THREE.Matrix4,r=e.isBone===!0?new THREE.Bone:new THREE.Object3D;return void 0!==e.name&&(r.name=THREE.PropertyBinding.sanitizeNodeName(e.name)),e.extras&&(r.userData=e.extras),void 0!==e.matrix?(a.fromArray(e.matrix),r.applyMatrix(a)):(void 0!==e.translation&&r.position.fromArray(e.translation),void 0!==e.rotation&&r.quaternion.fromArray(e.rotation),void 0!==e.scale&&r.scale.fromArray(e.scale)),r}).then(function(t){return r._withDependencies(["meshes","skins","cameras"]).then(function(r){return i(t,function(n,s){var i,o=e.nodes[s];if(void 0!==o.mesh?i=[o.mesh]:void 0!==o.meshes&&(console.warn("THREE.GLTFLoader: Legacy glTF file detected. Nodes may have no more than one mesh."),i=o.meshes),void 0!==i)for(var l in i){var u=i[l],c=r.meshes[u];if(void 0!==c){var p=c.clone(!1);for(var d in c.children){var f=c.children[d],m=f,h=f.material,T=f.geometry,v=f.morphTargetInfluences,R=f.userData,g=f.name,M=h;switch(f.type){case"LineSegments":f=new THREE.LineSegments(T,M);break;case"LineLoop":f=new THREE.LineLoop(T,M);break;case"Line":f=new THREE.Line(T,M);break;case"Points":f=new THREE.Points(T,M);break;default:f=new THREE.Mesh(T,M),f.drawMode=m.drawMode}f.castShadow=!0,f.morphTargetInfluences=v,f.userData=R,f.name=g;var S;if(void 0!==o.skin&&(S=r.skins[o.skin]),S){var H=T;M=h,M.skinning=!0,f=new THREE.SkinnedMesh(H,M),f.castShadow=!0,f.userData=R,f.name=g;for(var L=[],A=[],y=0,w=S.joints.length;y<w;y++){var x=S.joints[y],_=t[x];if(_){L.push(_);var b=S.inverseBindMatrices.array,F=(new THREE.Matrix4).fromArray(b,16*y);A.push(F)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',x)}f.bind(new THREE.Skeleton(L,A),f.matrixWorld)}p.add(f)}n.add(p)}else console.warn('THREE.GLTFLoader: Could not find node "'+u+'".')}if(void 0!==o.camera){var I=r.cameras[o.camera];n.add(I)}if(o.extensions&&o.extensions[E.KHR_LIGHTS]&&void 0!==o.extensions[E.KHR_LIGHTS].light){var O=a[E.KHR_LIGHTS].lights;n.add(O[o.extensions[E.KHR_LIGHTS].light])}return n})})})},p.prototype.loadScenes=function(){function e(r,t,n){var s=n[r];t.add(s);var i=a.nodes[r];if(i.children)for(var o=i.children,l=0,u=o.length;l<u;l++){var c=o[l];e(c,s,n)}}var a=this.json,r=this.extensions;return this._withDependencies(["nodes"]).then(function(t){return i(a.scenes,function(a){var n=new THREE.Scene;void 0!==a.name&&(n.name=a.name),a.extras&&(n.userData=a.extras);for(var s=a.nodes||[],i=0,o=s.length;i<o;i++){var l=s[i];e(l,n,t.nodes)}if(n.traverse(function(e){e.material&&e.material.isGLTFSpecularGlossinessMaterial&&(e.onBeforeRender=r[E.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms)}),a.extensions&&a.extensions[E.KHR_LIGHTS]&&void 0!==a.extensions[E.KHR_LIGHTS].light){var u=r[E.KHR_LIGHTS].lights;n.add(u[a.extensions[E.KHR_LIGHTS].light])}return n})})},e}();